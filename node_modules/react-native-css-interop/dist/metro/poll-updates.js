"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.sendUpdate = exports.middleware = void 0;
const connections = new Set();
function middleware(req, res) {
    connections.add(res);
    res.writeHead(200, {
        "Content-Type": "text/event-stream",
        "Cache-Control": "no-cache",
        Connection: "keep-alive",
    });
    setTimeout(() => {
        res.end();
        connections.delete(res);
    }, 5000);
    req.on("close", () => {
        connections.delete(res);
    });
}
exports.middleware = middleware;
function sendUpdate() {
    for (const connection of connections) {
        connection.write("data: update\n\n");
        connection.end();
    }
}
exports.sendUpdate = sendUpdate;
//# sourceMappingURL=poll-updates.js.map