"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.upsertGlobalStyle = exports.opaqueStyles = exports.globalStyles = void 0;
const observable_1 = require("../observable");
const globals_1 = require("./globals");
exports.globalStyles = new Map();
exports.opaqueStyles = new WeakMap();
function upsertGlobalStyle(name, ruleSet) {
    let styleObservable = exports.globalStyles.get(name);
    if (!styleObservable) {
        styleObservable = (0, observable_1.observable)(ruleSet, { name });
        exports.globalStyles.set(name, styleObservable);
        if (process.env.NODE_ENV !== "production") {
            const originalGet = styleObservable.get;
            styleObservable.get = () => {
                const value = originalGet();
                printWarnings(name, value);
                return value;
            };
        }
    }
    styleObservable.set(ruleSet);
}
exports.upsertGlobalStyle = upsertGlobalStyle;
function printWarnings(name, ruleSet) {
    if (!("$$type" in ruleSet) || !ruleSet.warnings)
        return;
    if (process.env.NODE_ENV === "test") {
        globals_1.warnings.set(name, ruleSet.warnings);
    }
    else {
        globals_1.warned.add(name);
    }
}
//# sourceMappingURL=style-store.js.map