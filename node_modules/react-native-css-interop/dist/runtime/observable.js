"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.cleanupEffect = exports.observable = void 0;
function observable(value, { fallback, name } = {}) {
    const effects = new Set();
    return {
        name,
        get(effect) {
            if (effect) {
                effects.add(effect);
                effect.dependencies.add(() => effects.delete(effect));
            }
            return value ?? fallback?.get(effect);
        },
        set(newValue) {
            if (Object.is(newValue, value))
                return;
            value = newValue;
            for (const effect of [...effects]) {
                effect.rerun();
            }
        },
    };
}
exports.observable = observable;
function cleanupEffect(effect) {
    for (const dep of effect.dependencies) {
        dep();
    }
    effect.dependencies.clear();
}
exports.cleanupEffect = cleanupEffect;
//# sourceMappingURL=observable.js.map